<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô </title>

    <!-- TailwindCSS -->
    <link href="/stylesheets/output.css" rel="stylesheet" />

</head>
<body class="bg-background ">

<!-- Navbar-->
<nav class="bg-transparent max-w-screen">
    <div class="max-w-full max-w-screen fixed flex m-5 top-0 items-center justify-between p-4 gap-2 drop-shadow-lg">
        <a id="rewardPage" class="flex items-center space-x-3 rtl:space-x-reverse">
            <img src="images/LOGO_KasetFairVerse.png" class="h-12" />
            <span class="self-center font-semibold text-blue whitespace-nowrap dark:text-white"> KASETFAIR VERSE </span>
        </a>
    </div>
</nav>

<!-- content -->
<div class="flex flex-col mx-auto pt-12 lg:px-16 container pt-16">
    <div class="flex flex-col lg:flex-row items-center justify-center w-full ">
        <h1 class="text-4xl lg:text-6xl text-blue font-bold">
            ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
        </h1>
    </div>

    <div class="flex flex-col lg:flex-row items-center justify-center w-full pb-0 my-0">
        <div class="flex flex-col lg:flex-row items-end justify-end gap-2 w-full my-0 py-0">
            <div class="flex flex-col">
                <a id="refreshButton">
                    <button class="text-xl bg-primary hover:bg-secondary hover:text-gray-900 text-white font-semibold py-1 px-2 border border-gray-400 rounded-xl shadow">
                        ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä üïî
                    </button>
                </a>
            </div>
        </div>
    </div>

    <div class="bg-white lg:pt-6 lg:py-6 p-6 border rounded-md  my-4 flex flex-col lg:flex-col items-center flex-wrap">

        <% if (user_coupons_list.length < 1) { %>
        <div class="flex flex-col items-center justify-center w-full pb-0 my-0">
            <h2 class="text-xl lg:text-2xl text-orange-700 font-bold">
                ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
            </h2>
        </div>
        <% } %>

        <div class="flex flex-col items-center justify-center w-full py-4 my-0">
            <h2 class="text-mg lg:text-lg text-orange-700 font-bold text-center">
                ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ä‡∏ô‡∏¥‡∏î‡∏•‡∏∞ 1 ‡πÉ‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br>
                (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏Å‡∏≥‡∏ô‡∏±‡∏• KFC ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡πÉ‡∏ö)<br>
                ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
            </h2>
        </div>

        <% for (let i in user_coupons_list) {%>

        <section class="p-1">
            <!--card-->
            <div class="container mx-auto">
                <div class="flex flex-col lg:flex-row <% if (i % 2 == 1) { %>bg-secondary<% } else { %> bg-[RGB(118,190,210)] <% } %> text-white text-center py-4 px-20 rounded-lg shadow-xl relative">

                    <div class="flex flex-col sm:px-4 md:px-8 lg:mx-12">
                        <h3 class="text-md sm:text-xl font-semibold "> <%= user_coupons_list[i].reward.name %> </h3>
                        <h4 class="text-sm font-semibold mb-2"> <%= user_coupons_list[i].reward.from %> </h4>

                        <button type="button"
                                id="button_<%= user_coupons_list[i].coupon_uuid %>"
                                data-te-toggle="modal"
                                data-te-target="#_<%= user_coupons_list[i].coupon_uuid %>"
                                class="border border-white hover:bg-gray-100 bg-white text-primary text-sm sm:text-md px-4 py-2 rounded-lg cursor-pointer">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                    </div>

                    <div class="w-12 h-12 bg-white rounded-full absolute top-1/2 transform -translate-y-1/2 left-0 -ml-6"></div>
                    <div class="w-12 h-12 bg-white rounded-full absolute top-1/2 transform -translate-y-1/2 right-0 -mr-6"></div>

                </div>
            </div>
        </section>

        <!--Modal -->
        <div
                data-te-modal-init
                class="fixed left-0 top-0 z-[1055] hidden h-full w-full overflow-y-auto overflow-x-hidden outline-none"
                id="_<%= user_coupons_list[i].coupon_uuid %>"
                tabindex="-1"
                aria-modal="true"
                role="dialog">
            <div data-te-modal-dialog-ref
                 class="pointer-events-none relative flex min-h-[calc(100%-1rem)] w-auto translate-y-[-50px] items-center opacity-0 transition-all duration-300 ease-in-out min-[576px]:mx-auto min-[576px]:mt-7 min-[576px]:min-h-[calc(100%-3.5rem)] min-[576px]:max-w-[600px]">
                <div class="pointer-events-auto relative p-2 flex w-full flex-col rounded-md border-none bg-secondary bg-clip-padding text-current shadow-lg outline-none dark:bg-neutral-600 mx-12">
                    <!-- coupon -->
                    <div class="flex flex-shrink-0 justify-between rounded-t-md border-neutral-100 border-opacity-100 p-4">
                        <div class="container mx-auto">
                            <div class="grid grid-rows-1 sm:grid-cols-2 bg-white text-white py-4 px-10 rounded-lg relative">

                                <section class="flex flex-col text-gray-900">
                                    <div class="text-xl font-semibold"> ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• </div>
                                    <div> <u>‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á:</u><br> <%= user_coupons_list[i].user.username %> </div>
                                    <div> <u>‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•:</u><br> <%= user_coupons_list[i].reward.name %> <%= user_coupons_list[i].reward.from %> </div>
                                    <div class="text-lg font-semibold"> <br> ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç </div>
                                    <div>
                                        - ‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à <br>
                                        ‡∏°.‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏ö‡∏≤‡∏á‡πÄ‡∏Ç‡∏ô  <br>
                                        - ‡πÅ‡∏•‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 10 ‡∏Å.‡∏û. 67 <br>
                                        ‡πÄ‡∏ß‡∏•‡∏≤ 15.00 - 19.00 ‡∏ô. <br>
                                    </div>
                                </section>

                                <section class="pt-8 sm:pt-0 flex flex-col text-gray-900 items-center">
                                    <div class="">
                                        <img src="data:image/png;base64,<%= user_coupons_list[i].qr_code.toString('base64') %>" class="w-40 mx-auto rounded-lg drop-shadow shadow-inner">
                                    </div>
                                    <div class="font-semibold">
                                        <br> ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á
                                    </div>
                                    <div>
                                        <p class="text-center">
                                            <%= user_coupons_list[i].coupon_uuid %>
                                        </p>
                                    </div>
                                    <!-- coupon shape -->
                                    <div class="w-12 h-12 bg-secondary rounded-full absolute top-1/2 transform -translate-y-1/2 left-0 -ml-6"></div>
                                    <div class="w-12 h-12 bg-secondary rounded-full absolute top-1/2 transform -translate-y-1/2 right-0 -mr-6"></div>
                                </section>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <% } %>

    </div>

</div>

<script nonce="<%= nonce %>">

    btn = document.getElementById("button_<%= first_popup %>");
    if (btn !== null) {
        document.addEventListener('DOMContentLoaded', function() {
            btn.click();
        });
    }


    // Get the current URL
    const currentUrl = window.location.href;

    // Create a URL object from the current URL
    const url = new URL(currentUrl);

    // Get the search part of the URL, including the '?'
    const searchParams = url.search;

    // Create a URLSearchParams object from the search part
    const urlSearchParams = new URLSearchParams(searchParams);

    // Get the value of the 'access_token' parameter
    const accessToken = urlSearchParams.get('access_token');

    // Now you can use the 'accessToken' variable wherever you need it
    console.log(currentUrl, accessToken);

    rewardPage.href = "/reward?access_token=" + accessToken;
    refreshButton.href = "/my_coupon?access_token=" + accessToken;

    // make the page reload every 10 seconds
    setTimeout(function() {
        location.href = "/my_coupon?access_token=" + accessToken;
    }, 15000);

</script>

<!-- TW Elements JavaScript -->
<script src="/tw-elements/dist/js/tw-elements.umd.min.js" type="text/javascript"></script>

</body>
</html>